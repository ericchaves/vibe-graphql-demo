# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added

### Changed
- Refactored `getVisitas` query to accept `cursorArgs: CursorModeInput` and `offsetArgs: PaginationModeInput` for pagination, replacing direct pagination arguments. This improves clarity and structure for pagination parameters.
- Updated `schema.py` with `CursorModeInput` and `PaginationModeInput` types.
- Modified `get_visitas` resolver logic and validation to use the new input types.
- Updated `tests/test_graphql_api.py` to align with the new pagination argument structure.
- Revised `README.md` to document the new input types, updated `getVisitas` signature, and modified pagination examples.

### Deprecated

### Removed

### Fixed

### Security

## [stage-12.0] - 2025-05-08

### Added
- Added offset-based pagination arguments (`limit`, `offset`) to `getVisitas` query.
- Added `totalCount` field to `VisitaConnection` type.
- Implemented hybrid pagination logic in `getVisitas` resolver:
  - Detects pagination mode (cursor, offset, default) based on arguments.
  - Validates against conflicting pagination arguments.
  - Calculates `totalCount` based on filters.
  - Conditionally applies cursor or offset/limit logic to SQL query.
  - Conditionally calculates `PageInfo` based on pagination mode.
- Added integration tests for offset pagination, default pagination, `totalCount`, and argument conflicts.

### Changed
- Updated `README.md` to document hybrid pagination, `totalCount`, validation rules, and add offset examples.

## [stage-11.0] - 2025-05-08

### Added
- Implemented Relay Cursor Connections pagination for the `getVisitas` query.
  - Defined `PageInfo`, `VisitaEdge`, and `VisitaConnection` types in `schema.py`.
  - Added pagination arguments (`first`, `after`, `last`, `before`) to `getVisitas` query.
  - Updated `getVisitas` resolver in `schema.py` to handle cursor encoding/decoding, SQL query modification (ORDER BY, LIMIT, cursor conditions), and result processing for connection structure.
- Added integration tests in `tests/test_graphql_api.py` for various pagination scenarios (forward, backward, with filters).

### Changed
- Modified `getVisitas` query return type from `List[VisitaType]` to `VisitaConnection`.
- Updated `README.md` to document pagination arguments, return structure, and provide usage examples.
- Updated existing integration tests in `tests/test_graphql_api.py` to work with the new Connection structure.

## [stage-10.0] - 2025-05-08

### Added
- Added `between` and `notBetween` operators to `IntFilterInput` and `DateTimeFilterInput` in `schema.py`.
- Added `AND` and `OR` logical operators to `VisitaFilterInput` in `schema.py` for combining filters.
- Added new unit tests in `tests/test_query_builder.py` for `BETWEEN`, `NOT BETWEEN`, `AND`, `OR`, and nested logic.
- Added new integration tests in `tests/test_graphql_api.py` for the new filter functionalities.

### Changed
- Refactored `build_where_clause` function in `schema.py` to use a recursive approach (`_build_clause_recursively`) for handling complex filter logic and operator precedence.
- Updated `README.md` with examples for all supported filter operations, including `BETWEEN`, `NOT BETWEEN`, `AND`, and `OR`.

### Fixed
- Adjusted assertions in `tests/test_query_builder.py` to match the actual SQL parenthesis structure generated by the refactored `build_where_clause`, ensuring all tests pass.

## [stage-9.0] - 2025-05-08

### Added
- Created `Makefile` with targets for `test` (run tests), `run-server` (initialize DB, seed data, run server), and `clean` (Etapa 9).
- Updated `tasks.md` and `changelog.md` to reflect completion of Etapa 9.
- Corrected `Makefile` `run-server` target to use `python -m uvicorn main:app --reload`.

### Changed
- Updated `.clinerules/project_workflow.md` and `README.md` to reflect hybrid dependency management (pip in devcontainer, uv on host).
- Revised `Makefile` to conditionally activate virtual environment.

### Fixed
- Corrected table alias usage in `tests/test_query_builder.py` assertions.
- Corrected timestamp parsing in `tests/test_graphql_api.py`.

## [stage-7.0] - 2025-05-08

### Added
- Initial project setup and configuration (Etapa 0).
- Database modeling and creation script (Etapa 1).
- Defined GraphQL types with Strawberry (Etapa 2), including consolidated `VisitaType` and `InputFilter` types.
- Implemented GraphQL resolvers (Etapa 3), including database interaction and dynamic query building with filters.
- Created script for generating and inserting example data (Etapa 4).
- Implemented backend filtering logic (Etapa 5), translating InputFilters to SQL WHERE clauses.
- Added unit and integration tests (Etapa 6) for query building and GraphQL API.
- Completed final documentation (Etapa 7), including expanded README and API documentation.
